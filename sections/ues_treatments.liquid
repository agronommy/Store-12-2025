{% assign ai_gen_id = section.id | replace: '_', '' | downcase %}

{% style %}
 .ai-treatments-{{ ai_gen_id }} {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: {{ section.settings.card_spacing | default: 24 }}px;
  padding: {{ section.settings.section_padding | default: 20 }}px;

  max-width: 1400px;   /* keeps rows from stretching too wide */
  margin: 0 auto;      /* centers grid horizontally */
}

/* Force max 4 per row on large screens */
@media (min-width: 1200px) {
  .ai-treatments-{{ ai_gen_id }} {
    grid-template-columns: repeat(4, 1fr);
  }
}
  .ai-treatment-card-{{ ai_gen_id }} {
    display: flex !important;
    flex-direction: column;
    height: 100%;
    border: 1px solid #ddd;
    border-radius: {{ section.settings.card_border_radius | default: 8 }}px;
    background: {{ section.settings.card_background_color | default: '#fff' }};
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    overflow: hidden;
    }
  .ai-treatment-card-{{ ai_gen_id }}.hidden {
  display: none !important;
}

  .ai-treatment-img-{{ ai_gen_id }} {
    width: 100%;
    height: {{ section.settings.image_height | default: 200 }}px;
    object-fit: cover;
    flex-shrink: 0;
  }

  .ai-treatment-info-{{ ai_gen_id }} {
    display: flex !important;
    flex-direction: column;
    flex-grow: 1;
    padding: {{ section.settings.card_padding | default: 16 }}px;
  }

  .ai-treatment-title-{{ ai_gen_id }} {
    font-size: {{ section.settings.title_size | default: 20 }}px;
    font-weight: bold;
    color: {{ section.settings.title_color | default: '#000' }};
    margin-bottom: 8px;
  }

   .ai-treatment-description-wrapper-{{ ai_gen_id }} {
  position: relative;
     overflow: hidden;
 }

.ai-treatment-description-{{ ai_gen_id }} {
  max-height: 9.4em;
  overflow: hidden;
  position: relative;
  transition: max-height 0.3s ease;
}

.ai-treatment-description-{{ ai_gen_id }}.expanded {
  max-height: none;
}

.ai-treatment-description-{{ ai_gen_id }}::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  height: 2em;
  width: 100%;
  background: linear-gradient(to bottom, rgba(255,255,255,0), {{ section.settings.card_background_color | default: '#fff' }});
  pointer-events: none;
}

.ai-treatment-description-{{ ai_gen_id }}.expanded::after {
  display: none;
}

.ai-read-more-btn-{{ ai_gen_id }} {
  margin-top: 8px;
  background: none;
  border: none;
  color: #007bff;
  cursor: pointer;
  padding: 0;
  font-size: 14px;
  text-align: left;
}

  .ai-treatment-bottom-{{ ai_gen_id }} {
    margin-top: auto;
  }

  .ai-treatment-meta-{{ ai_gen_id }} {
    display: flex !important;
    justify-content: space-between;
    font-size: {{ section.settings.details_size | default: 13 }}px;
    color: {{ section.settings.details_color | default: '#888' }};
    align-items: center;
    padding-top: 12px;
    border-top: 1px solid #eee;
  }

  .ai-treatment-contact-{{ ai_gen_id }} {
    padding-top: 8px;
    color: #444;
  }

  .ai-treatment-contact-{{ ai_gen_id }} a {
    text-decoration: none;
    color: #444;
  }

  .ai-time-icon-{{ ai_gen_id }} {
    display: inline-block;
    width: 16px;
    height: 16px;
    margin-right: 6px;
    vertical-align: text-bottom;
  }
  .ai-treatment-card-{{ ai_gen_id }} {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

.ai-treatment-filter-bar-{{ ai_gen_id }} {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: flex-start;   /* <-- align with card start */
  gap: 8px;

  max-width: 1400px;  /* match the cards grid */
  margin: 0 auto 20px auto; /* center block, add spacing below */
  padding: 0 10px;    /* optional: small padding so it doesnâ€™t touch edges */
}

.ai-filter-label {
  display: inline-flex;
  align-items: center;
  height: 32px;   
  padding: 0 12px;
  background: #e9ecef;
  border-radius: 16px;
  font-weight: 600;
  color: #333;
}

.ai-filter-label:hover {
  background-color: #dee2e6;
}

.ai-filter-btn {
  padding: 6px 14px;
  background-color: #f0f0f0;
  border: none;
  border-radius: 16px;
  color: #333;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}

.ai-filter-btn:hover {
  background-color: #e0e0e0;
  transform: translateY(-1px);
}

.ai-filter-btn.active {
  background-color: #333;
  color: #fff;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}


{% endstyle %}



<!-- Filter Section -->
<div class="ai-treatment-filter-bar-{{ ai_gen_id }}">
 <span class="ai-filter-label">Filter by treatment type:</span>
  {% assign custom_order = "facials,body,add-ons,nails,lash & brow" | split: ',' %}
  {% assign types_string = '' %}
  
  {% for entry in shop.metaobjects.ues_treatments.values %}
    {%- assign type_clean = entry.treatment_type | strip | handleize -%}
    {%- unless types_string contains type_clean -%}
      {% assign types_string = types_string | append: ',' | append: type_clean %}
    {%- endunless -%}

    
  {% endfor %}
  {% assign types_array = types_string | remove_first: ',' | split: ',' %}
  
 <div class="ai-treatment-filter-bar-{{ ai_gen_id }}">
  <div class="ai-filter-group">
    
    <div class="ai-filter-options" data-filter-group="type">
      <button class="ai-filter-btn active" data-filter-value="all">All</button>
    {% for type in custom_order %}
  {% if types_array contains type %}
    {% comment %} Decide label formatting {% endcomment %}
    {% if type == 'add-ons' %}
      {% assign label = 'Addâ€‘ons' %}
    {% elsif type == 'lash-&-brow' %}
      {% assign label = 'Lash & Brow' %}
    {% else %}
      {% assign label = type | replace: '-', ' ' | capitalize %}
    {% endif %}

    <button class="ai-filter-btn" data-filter-value="{{ type }}">
      {{ label }}
    </button>
  {% endif %}
{% endfor %}

    </div>
  </div>

  
</div>


</div>

<!-- Treatment Cards -->
<div class="ai-treatments-{{ ai_gen_id }}">
 
  {% assign all_treatments = shop.metaobjects.ues_treatments.values %}

  {%- comment -%}
  Helper: function to append entries matching a type to sorted_treatments
  {%- endcomment -%}
  {% assign order = "Facials,Add-ons,Body,Lash & Brow,Nails" | split: "," %}

  {% for category in order %}
    {% for entry in all_treatments %}
      {% assign type_raw = entry.treatment_type | replace: '["', '' | replace: '"]', '' | replace: '","', ',' | strip %}
      {% if type_raw == category %}
        <div class="ai-treatment-card-{{ ai_gen_id }}"  
             data-type="{{ type_raw | handleize }}"  
             data-name="{{ entry.title | escape }}"  
             data-price="{{ entry.price.value }}"  
             data-duration="{{ entry.duration | replace: ' min','' }}">

          <img 
  class="ai-treatment-img-{{ ai_gen_id }}" 
  src="{{ entry.image | image_url: width: 600 }}" 
  srcset="
    {{ entry.image | image_url: width: 400 }} 400w,
    {{ entry.image | image_url: width: 600 }} 600w,
    {{ entry.image | image_url: width: 900 }} 900w,
    {{ entry.image | image_url: width: 1200 }} 1200w
  " 
  sizes="(max-width: 600px) 100vw, 600px" 
  width="{{ entry.image.width }}" 
  height="{{ entry.image.height }}" 
  alt="{{ entry.title | escape }}" 
  loading="lazy">
          <div class="ai-treatment-info-{{ ai_gen_id }}">
            <div class="ai-treatment-content-{{ ai_gen_id }}">
              <h3 class="ai-treatment-title-{{ ai_gen_id }}">{{ entry.title }}</h3>
              <div class="ai-treatment-description-wrapper-{{ ai_gen_id }}">
                <div class="ai-treatment-description-{{ ai_gen_id }}">
                  {{ entry.description | metafield_tag }}
                </div>
                <button class="ai-read-more-btn-{{ ai_gen_id }}">Read More</button>
              </div>
            </div>

            <div class="ai-treatment-bottom-{{ ai_gen_id }}">
              <div class="ai-treatment-meta-{{ ai_gen_id }}">
                <span>
                  <svg class="ai-time-icon-{{ ai_gen_id }}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  {{ entry.duration }}
                </span>
                <span>{{ entry.price.value | money }}</span>
              </div>
              <div class="ai-treatment-contact-{{ ai_gen_id }}">
                <a href="tel:212-861-1007">ðŸ“ž Contact</a>
              </div>
              <div class="ai-treatment-contact-{{ ai_gen_id }}"><a href="https://aidabicaj.com/pages/upper-east-side-skincare-treatments/#book-now"><svg style="vertical-align: middle;" xmlns="http://www.w3.org/2000/svg" 
     width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="red">
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="red" stroke-width="2"/>
  <line x1="8" y1="2" x2="8" y2="6" stroke="red" stroke-width="2" stroke-linecap="round"/>
  <line x1="16" y1="2" x2="16" y2="6" stroke="red" stroke-width="2" stroke-linecap="round"/>
  <line x1="3" y1="10" x2="21" y2="10" stroke="red" stroke-width="2" stroke-linecap="round"/>
</svg>
<span>Book an Appointment</span>
</a>
</div>
      <div class="ai-treatment-contact-{{ ai_gen_id }}">
  <a href="https://book.aidabicaj.com/#/206945000000057091">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="red" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;">
      <path d="M21 16.5V7.5C21 6.12 19.88 5 18.5 5H5.5C4.12 5 3 6.12 3 7.5v9C3 17.88 4.12 19 5.5 19h13c1.38 0 2.5-1.12 2.5-2.5zM8 15V9l5 3-5 3zm9-6.5l3 2v3l-3 2v-7z"/>
    </svg>
    Online Consultation
  </a>
</div>
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  {% endfor %}
</div>



<script>
document.addEventListener("DOMContentLoaded", function () {
  const cards = document.querySelectorAll(".ai-treatment-card-{{ ai_gen_id }}");
  let selectedType = "all";

  function updateActiveButtons(value) {
    document.querySelectorAll('.ai-filter-btn').forEach(btn => {
      btn.classList.toggle("active", btn.dataset.filterValue === value);
    });
  }

  function applyFilters() {
    console.log("Filtering:", selectedType);
    cards.forEach(card => {
      const cardType = card.dataset.type;
      const show = (selectedType === 'all' || cardType === selectedType);
      console.log(cardType, show);
      card.classList.toggle('hidden', !show);
    });
  }

  document.querySelectorAll(".ai-filter-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const value = btn.dataset.filterValue;
      selectedType = value;
      updateActiveButtons(value);
      applyFilters();
    });
  });

  applyFilters();
});
</script>



<script>
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".ai-treatment-description-wrapper-{{ ai_gen_id }}").forEach(wrapper => {
    const desc = wrapper.querySelector(".ai-treatment-description-{{ ai_gen_id }}");
    const btn = wrapper.querySelector(".ai-read-more-btn-{{ ai_gen_id }}");

    // Check if the content overflows
    if (desc.scrollHeight > desc.clientHeight) {
      btn.style.display = "inline";
      btn.addEventListener("click", function () {
        desc.classList.toggle("expanded");
        btn.textContent = desc.classList.contains("expanded") ? "Read Less" : "Read More";
      });
    } else {
      btn.style.display = "none";
    }
  });
});
</script>




{% schema %}
{
  "name": "UES Treatments",
  "settings": [
    {
      "type": "range",
      "id": "card_spacing",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Card spacing",
      "default": 24
    },
    {
      "type": "range",
      "id": "section_padding",
      "min": 0,
      "max": 60,
      "step": 4,
      "unit": "px",
      "label": "Section padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 12,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Card padding",
      "default": 16
    },
    {
      "type": "range",
      "id": "image_height",
      "min": 150,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Image height",
      "default": 200
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 14,
      "max": 32,
      "step": 1,
      "unit": "px",
      "label": "Title size",
      "default": 20
    },
    {
      "type": "range",
      "id": "description_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Description size",
      "default": 14
    },
    {
      "type": "range",
      "id": "details_size",
      "min": 12,
      "max": 16,
      "step": 1,
      "unit": "px",
      "label": "Details font size",
      "default": 13
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "details_color",
      "label": "Details color",
      "default": "#888888"
    },
    {
      "type": "color",
      "id": "card_background_color",
      "label": "Card background color",
      "default": "#ffffff"
    }
  ],
  "presets": [
    {
      "name": "UES Treatments"
    }
  ]
}
{% endschema %}
