<script
  type="application/json"
  data-section-type="collection-list"
  data-section-id="{{ section.id }}"
>
</script>

{% liquid
  assign blocks = section.blocks
  assign title = section.settings.title | escape
 
%}

{% style %}
  {% render 'section-space' %}


  {%
    render 'css-loop',
    css: section.settings.custom_css,
    id: section.id,
  %}
{% endstyle %}

{% if blocks.size > 0 %}
  <section class="section {{ section.settings.css_class }}">
    <div class="container" id="results">
      {% if title != blank %}
        <div class="one-whole column center">
          <h2 class="title">{{ title }}</h2>
          <div class="feature-divider"></div>
        </div>
      {% endif %}

      <div class="one-whole column">
        <div class="list-collections-wrapper">

          <div class="list-collections equal-columns--outside-trim is-flex is-flex-wrap">
            {% for block in blocks %}
  {% assign collection = collections[block.settings.feature_collection] -%}
  {%- assign customtitle = block.settings.custom_title -%}
  {%- assign customurl = block.settings.custom_url -%}

  {% assign is_active = false %}

{%- assign raw_url = block.settings.custom_url -%}
{%- if raw_url == blank and collection != blank -%}
  {%- assign raw_url = collection.url -%}
{%- endif -%}

{%- assign data_url = raw_url | split: '?' | first | strip -%}

 

  <!-- Now show debug output or render layout here -->


              
              {%- assign image = block.settings.image -%}
              {% comment %} End content settings {% endcomment %}

              {% if image %}
                {%- assign collection_image = image -%}
                {%- assign collection_image_alt = image.alt | escape -%}
              {% elsif collection.image != blank %}
                {%- assign collection_image = collection.image -%}
                {%- assign collection_image_alt = collection.title | escape -%}
              {% else collection.empty? == false %}
                {%- assign collection_image = collection.products.first.featured_image -%}
                {%- assign collection_image_alt = collection.products.first.featured_image.alt | escape -%}
                
              {% endif %}

              <div class="{% render 'column-width', value: section.settings.frontpage_collections_per_row %} column {% if section.settings.collection_count == blank and section.settings.frontpage_collections_title == blank %}blank{% endif %} thumbnail {% if settings.mobile_products_per_row == '1' %} medium-down--one-half small-down--one-whole {% else %} medium-down--one-half small-down--one-half {% endif %}" {{ block.shopify_attributes }}>
             {%- assign raw_url = block.settings.custom_url | default: collection.url -%}
{%- assign data_url = raw_url | strip -%}

<div class="product-wrap subcollection-block{% if is_active %} active{% endif %}" data-url="{{ data_url }}">




                  {% if collection_image != blank %}
                    <div class="image__container">
                      {%
                        render 'image-element',
                        image: collection_image,
                        alt: collection_image_alt,
                        object_fit: section.settings.align_height,
                        max_height: section.settings.collection_height,
                        focal_point: collection_image.presentation.focal_point,
                      %}
                    </div>
                  {% else %}
                    {% capture num %}{% cycle "1", "2", "3", "4", "5", "6" %}{% endcapture %}
                    {{ 'collection-' | append: num | placeholder_svg_tag: 'placeholder-svg' }}
                  {% endif %}
{% comment %}
   {%- if collections[block.settings.custom_title] != blank %}
      {% else %}
                {% assign collection = collections[block.settings.custom_tile] %}
                {% endif %}
{% endcomment %}
                  {%  if customurl != blank %}
                  <a href="{{ customurl | default: collection.url }}" class="hidden-product-link">

                    {% else %}
                    <a href="{{ collection.url }}" class="hidden-product-link">
                  {% endif %}
                    {% if collection != blank %}
                      {{ collection.title }}
                    {% else %}
                      {{ 'homepage.onboarding.collection_title' | t }}
                    {% endif %}
                  </a>

                  {% if settings.thumbnail_hover_enabled %}
                    <div class="thumbnail-overlay">
                      {% if customurl != blank %}
                      <a href="{{ customurl | default: collection.url }}" class="hidden-product-link">

                         {%  else %}
                      <a href="{{ collection.url }}" class="hidden-product-link">
                        {% endif %}
                        {% if collection != blank %}
                          {{ collection.title }}
                        {% else %}
                          {{ 'homepage.onboarding.collection_title' | t }}
                        {% endif %}
                      </a>

                      <div class="info">
                        <div class="collection-details">
                          <span class="title">
                            {% if collection != blank %}
                              {{ collection.title }}
                              
                            {% else %}
                              {{ 'homepage.onboarding.collection_title' | t }}
                            {% endif %}
                          </span>
                        </div>
                        <a
                          {% if customurl != blank %}
                          href="{{ customurl }}"
                            {%  else %}
                          href="{{ collection.url }}"
                          {% endif %}
                          title="{{ collection.title }}"
                          
                          class="thumbnail-overlay__button global-button global-button--product-grid-text-hover"
                        >
                          {{ 'collections.general.view_all' | t }}
                        </a>
                      </div>
                    </div>
                  {% endif %}

                  <a class="collection-info__caption {% if settings.thumbnail_hover_enabled %}hidden{% endif %}" href="{{ collection.url }}">
                    <span class="title">
                      {% if collection != blank %}
                        {% if customtitle != blank %}
                        {{ customtitle }}
                        
                        {% else %}
                        {{ collection.title }}
                        {% endif %}
                      {% else %}
                        {{ 'homepage.onboarding.collection_title' | t }}
                      {% endif %}
                    </span>
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </section>
{% endif %}

{% if section.settings.align_height == true %}
  <style>
    #shopify-section-{{ section.id }} .list-collections .thumbnail img {
      max-height: {{ section.settings.collection_height }}px;
    }
  </style>
{% endif %}

{% schema %}
{
  "name": "Collection list",
  "class": "shopify-section--collection-list",
  "max_blocks": 8,
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Collection 123list"
    },
    {
      "type": "checkbox",
      "id": "align_height",
      "label": "Align height of collection images",
      "default": false
    },
    {
      "type": "range",
      "id": "collection_height",
      "label": "Collection image height",
      "min": 150,
      "max": 400,
      "step": 10,
      "default": 200,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "frontpage_collections_per_row",
      "label": "Collections per row",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 3
    },
    {
      "type": "header",
      "content": "Section spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Top spacing",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Bottom spacing",
      "default": 0
    },
    {
      "type": "header",
      "content": "Advanced"
    },
    {
      "type": "paragraph",
      "content": "[Learn more](https://help.outofthesandbox.com/hc/en-us/articles/360022329373)"
    },
    {
      "type": "text",
      "id": "css_class",
      "label": "CSS Class"
    },
    {
      "type": "textarea",
      "id": "custom_css",
      "label": "Custom CSS"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "feature_collection",
          "label": "Collection"
        },
        {
          "type": "url",
          "id": "custom_url",
          "label": "Custom Url"
          
        },
        {
          "type": "text",
          "id": "custom_title",
          "label": "Custom title"
          
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection list",
      "category": "Collection",
      "blocks": [
        {
          "type": "collection"
        },
        {
          "type": "collection"
        },
        {
          "type": "collection"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": [ "*" ]
  }
}

{% endschema %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  const current = window.location.pathname + window.location.search;

  document.querySelectorAll('.subcollection-block').forEach(el => {
    const blockUrl = el.getAttribute('data-url');
    if (!blockUrl) return;

    // Normalize both sides
    const blockNormalized = new URL(blockUrl, window.location.origin).pathname + new URL(blockUrl, window.location.origin).search;

    if (blockNormalized === current) {
      el.classList.add('active');
    } else {
      el.classList.remove('active');
    }

    el.classList.add('js-ready');
  });
});

</script>

 <style>
 .subcollection-block {
  visibility: hidden;
}
.subcollection-block.js-ready {
  visibility: visible;
}


.product-wrap.active {
  border: 2px solid #222;
  border-radius: 8px;
  transform: scale(1.03);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
  background-color: #fdfdfd;
  pointer-events: none;
  opacity: 0.85;
}

</style>
