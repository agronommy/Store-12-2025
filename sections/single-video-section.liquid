{% liquid
  assign section_id = 'pxu-single-video-' | append: section.id
  assign text_color = section.settings.text_color | default: '#000000'
  assign background_color = section.settings.background_color | default: '#F8F8F8'
  assign background_gradient = section.settings.background_gradient
  assign padding_top = section.settings.padding_top | default: 32
  assign padding_bottom = section.settings.padding_bottom | default: 32
  assign margin_top = section.settings.margin_top | default: 64
  assign margin_bottom = section.settings.margin_bottom | default: 64
%}

<section
  id="{{ section_id }}"
  class="pxu-single-video-section"
  style="--pxu-video-text-color: {{ text_color }};"
>
  <div class="pxu-single-video-section__background" aria-hidden="true"></div>

  <div
    class="pxu-single-video-section__inner"
    style="
      padding-top: {{ padding_top }}px;
      padding-bottom: {{ padding_bottom }}px;
      margin-top: {{ margin_top }}px;
      margin-bottom: {{ margin_bottom }}px;
    "
  >
    {% if section.settings.section_heading != blank %}
      <h2
        class="pxu-single-video-section__heading"
        style="font-size: clamp({{ section.settings.section_heading_size_mobile }}px, 3vw, {{ section.settings.section_heading_size }}px);"
      >
        {{ section.settings.section_heading }}
      </h2>
    {% endif %}

    <div class="pxu-single-video">
      <div class="pxu-single-video__media-wrapper pxu-single-video__media-wrapper--{{ section.settings.image_ratio }}">
        {% assign video_link = section.settings.video_link %}
        {% assign button_label = section.settings.button_label %}
        {% assign shopify_video = section.settings.shopify_video %}
        {% assign external_video = section.settings.external_video_url %}
        {% assign poster_image = section.settings.poster_image %}

        {% if video_link != blank and button_label == blank %}
          <a
            href="{{ video_link }}"
            class="pxu-single-video__media-link"
            aria-label="{{ section.settings.block_heading | default: button_label }}"
          >
        {% endif %}

        {% if shopify_video != blank %}
          {{ shopify_video | video_tag: autoplay: false, loop: false, muted: false, controls: true, poster: poster_image }}
        {% elsif external_video != blank %}
          {% case external_video.type %}
            {% when 'youtube' %}
              <iframe
                class="pxu-single-video__embed"
                src="https://www.youtube.com/embed/{{ external_video.id }}?rel=0&showinfo=0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
                title="{{ section.settings.block_heading | escape }}"
              ></iframe>
            {% when 'vimeo' %}
              <iframe
                class="pxu-single-video__embed"
                src="https://player.vimeo.com/video/{{ external_video.id }}?title=0&byline=0&portrait=0"
                allow="autoplay; fullscreen; picture-in-picture"
                allowfullscreen
                title="{{ section.settings.block_heading | escape }}"
              ></iframe>
          {% endcase %}
        {% else %}
          <div class="pxu-single-video__placeholder">
            Video placeholder
          </div>
        {% endif %}

        {% if video_link != blank and button_label == blank %}
          </a>
        {% endif %}
      </div>

      <div class="pxu-single-video__content">
        {% if section.settings.block_heading != blank %}
          <h3 class="pxu-single-video__title">
            {{ section.settings.block_heading }}
          </h3>
        {% endif %}

        {% if section.settings.block_text != blank %}
          <div class="pxu-single-video__text">
            {{ section.settings.block_text }}
          </div>
        {% endif %}

        {% if section.settings.button_label != blank and section.settings.button_url != blank %}
          <a
            class="pxu-single-video__button pxu-single-video__button--{{ section.settings.button_style }}"
            href="{{ section.settings.button_url }}"
            style="--pxu-video-button-bg: {{ section.settings.button_background_color }}; --pxu-video-button-text: {{ section.settings.button_text_color }};"
          >
            {{ section.settings.button_label }}
          </a>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<style>
  #{{ section_id }} {
    position: relative;
    color: var(--pxu-video-text-color);
  }

  #{{ section_id }} .pxu-single-video-section__background {
    position: absolute;
    inset: 0;
    z-index: 0;
    {% if background_gradient != blank %}
      background: {{ background_gradient }};
    {% else %}
      background: {{ background_color }};
    {% endif %}
  }

  #{{ section_id }} .pxu-single-video-section__inner {
    position: relative;
    z-index: 1;
  }

  #{{ section_id }} .pxu-single-video-section__heading {
    margin-bottom: 2rem;
    text-align: center;
  }

  #{{ section_id }} .pxu-single-video {
    display: grid;
    gap: 1.5rem;
  }

  #{{ section_id }} .pxu-single-video__media-wrapper {
    position: relative;
    overflow: hidden;
    width: 100%;
    background: rgba(0,0,0,0.05);
    border-radius: 12px;
  }

  #{{ section_id }} .pxu-single-video__media-wrapper::before {
    content: '';
    display: block;
    width: 100%;
    padding-bottom: 56.25%;
  }

  #{{ section_id }} .pxu-single-video__media-wrapper--square::before {
    padding-bottom: 100%;
  }

  #{{ section_id }} .pxu-single-video__media-wrapper--portrait::before {
    padding-bottom: 150%;
  }

  #{{ section_id }} .pxu-single-video__media-wrapper--landscape::before {
    padding-bottom: 56.25%;
  }

  #{{ section_id }} .pxu-single-video__media-wrapper > * {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border: none;
  }

  #{{ section_id }} .pxu-single-video__content {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    text-align: left;
  }

  #{{ section_id }} .pxu-single-video__title {
    margin: 0;
    font-size: clamp({{ section.settings.block_heading_size_mobile }}px, 2vw, {{ section.settings.block_heading_size }}px);
  }

  #{{ section_id }} .pxu-single-video__text {
    font-size: clamp({{ section.settings.block_text_size_mobile }}px, 1.8vw, {{ section.settings.block_text_size }}px);
  }

  #{{ section_id }} .pxu-single-video__button {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    padding: 0.9rem 1.5rem;
    border-radius: 999px;
    font-weight: 600;
    text-decoration: none;
    border: 2px solid transparent;
    transition: opacity 0.2s ease;
  }

  #{{ section_id }} .pxu-single-video__button--fill {
    background: var(--pxu-video-button-bg);
    color: var(--pxu-video-button-text);
  }

  #{{ section_id }} .pxu-single-video__button--outline {
    background: transparent;
    border-color: var(--pxu-video-button-bg);
    color: var(--pxu-video-button-bg);
  }

  #{{ section_id }} .pxu-single-video__button:hover {
    opacity: 0.85;
  }
</style>

{% schema %}
{
  "name": "Single video",
  "class": "pxu-single-video-section",
  "settings": [
    {
      "type": "inline_richtext",
      "id": "section_heading",
      "label": "Section heading",
      "default": "Our video"
    },
    {
      "type": "range",
      "id": "section_heading_size",
      "min": 16,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Heading size (desktop)",
      "default": 40
    },
    {
      "type": "range",
      "id": "section_heading_size_mobile",
      "min": 16,
      "max": 60,
      "step": 1,
      "unit": "px",
      "label": "Heading size (mobile)",
      "default": 30
    },

    {
      "type": "select",
      "id": "image_ratio",
      "label": "Video aspect ratio",
      "options": [
        { "value": "landscape", "label": "Landscape (16:9)" },
        { "value": "square", "label": "Square (1:1)" },
        { "value": "portrait", "label": "Portrait" }
      ],
      "default": "landscape"
    },

    {
      "type": "video",
      "id": "shopify_video",
      "label": "Shopify-hosted video"
    },
    {
      "type": "video_url",
      "id": "external_video_url",
      "label": "YouTube or Vimeo URL",
      "accept": ["youtube", "vimeo"]
    },
    {
      "type": "image_picker",
      "id": "poster_image",
      "label": "Poster image"
    },
    {
      "type": "url",
      "id": "video_link",
      "label": "Link when clicking video (optional)"
    },

    {
      "type": "text",
      "id": "block_heading",
      "label": "Block heading",
      "default": "Video heading"
    },
    {
      "type": "richtext",
      "id": "block_text",
      "label": "Block text",
      "default": "<p>Add a short description for this video.</p>"
    },

    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Learn more"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button link"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button style",
      "options": [
        { "value": "fill", "label": "Filled" },
        { "value": "outline", "label": "Outline" }
      ],
      "default": "fill"
    },
    {
      "type": "color",
      "id": "button_background_color",
      "label": "Button background color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#FFFFFF"
    },

    {
      "type": "header",
      "content": "Text & background colors"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#F8F8F8"
    },
    {
      "type": "color_background",
      "id": "background_gradient",
      "label": "Background gradient"
    },

    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Top padding",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Bottom padding",
      "default": 32
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Top margin",
      "default": 64
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Bottom margin",
      "default": 64
    },

    {
      "type": "header",
      "content": "Typography sizes"
    },
    {
      "type": "range",
      "id": "block_heading_size",
      "min": 12,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Block heading size (desktop)",
      "default": 24
    },
    {
      "type": "range",
      "id": "block_heading_size_mobile",
      "min": 12,
      "max": 60,
      "step": 1,
      "unit": "px",
      "label": "Block heading size (mobile)",
      "default": 24
    },
    {
      "type": "range",
      "id": "block_text_size",
      "min": 12,
      "max": 32,
      "step": 1,
      "unit": "px",
      "label": "Block text size (desktop)",
      "default": 16
    },
    {
      "type": "range",
      "id": "block_text_size_mobile",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Block text size (mobile)",
      "default": 16
    }
  ],
  "presets": [
    {
      "name": "Single video"
    }
  ]
}
{% endschema %}
